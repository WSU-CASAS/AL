from unittest import TestCase
from unittest.mock import patch, Mock

import numpy as np
from sklearn.cluster import KMeans

from al import AL, extract_features
from config import Config


class ExtractFeaturesTest(TestCase):
    # Testing the extract_features function

    # NOTE: This is mostly an integration test of the function and its sub-functions, but with some mocking
    # of external things like clustering

    @patch('features.load_clusters')
    def test_extractfeatures_nopersonfeatures_withabsolutegpsstatisticalfeatures(self, load_clusters_mock):
        """
        Test extract_features with lowpass filtering and person features turned off, but location features on.
        Also enable absolute GPS statistical features.
        """

        # arrange
        test_config = Config(description='test')
        test_config.datapath = './test_data/'  # point to the test data directory

        test_config.translate = True
        test_config.filter_data = False
        test_config.fftfeatures = 0
        test_config.sfeatures = 0
        test_config.gen_gps_abs_stat_features = True

        test_config.samplerate = 5  # 5Hz test data
        test_config.samplesize = test_config.samplerate * test_config.numseconds
        test_config.windowsize = test_config.samplesize * test_config.numsensors

        test_al = AL(conf=test_config)

        # Set up test mapping/location values
        test_al.aclass.amappings['Work'] = 'Coding'
        test_al.location.lmappings['motorway'] = 'road'
        test_al.location.locations.append([40.0, -117.0, 'motorway', 'administrative', 'boundary'])

        test_data_basename = 'extract_features_1'

        # Override the load_clusters function to load mock clusters:
        test_clusters = [Mock(spec=KMeans) for _ in range(5)]
        test_clusters[0].predict.return_value = np.array([1, 0, 0, 0, 0])
        test_clusters[1].predict.return_value = np.array([1, 0, 0, 2, 2])
        test_clusters[2].predict.return_value = np.array([2, 1, 1, 2, 2])
        test_clusters[3].predict.return_value = np.array([1, 1, 1, 1, 1])
        test_clusters[4].predict.return_value = np.array([2, 2, 2, 1, 0])

        load_clusters_mock.return_value = test_clusters

        expected_x_data = [
            [
                1.8231455326080321, 1.8186726808547973, 45.53627052307128, 1.8214508209228513, 1.8214417815208435, 1.8214508209228515, 1.8214417815208435, 82.94210665092187, 13.020868651100015, 3.317684266036875, 1.1729963449911204e-06, 0.0010830495579571234, 0.0008600555801391519, 0.0006173372268676314, 9, 9, 0.0, 1.1729963449911204e-06, -4.798868024981334e-10, 4.241837341899848e-12, 0.0012050986289977583, 0.0005946081802024106, -0.37774073248260204, 0.0829089122517992, 0.05612991594261147, 0.0010161643226941168, 0.0009241473558045313, 0.000860055580139143, 0.0006582558348109362, 8,
                -0.28015519082546236, -0.290841269493103, -7.152085608243943, -0.2860834243297577, -0.28541713058948515, 0.2860834243297577, 0.28541713058948515, 2.0462693489190147, -27.176301122165018, 0.08185077395676059, 7.048280520397238e-06, 0.0026548597929829058, 0.0021927347660064722, 0.0021347135305405107, 6, 4, 0.0, 7.048280520397238e-06, 2.498918740908194e-09, 1.2643493628796293e-10, 0.003398019075393721, -0.00928001962785075, 0.13354491721264125, -0.4549241332259828, 0.8711322421894913, 0.0013229637096325644, 0.0010420670683976133, 0.0021927347660064722, 0.0014967280201639106, 2,
                0.20482647716999053, 0.19922617226839065, 5.03618904352188, 0.2014475617408752, 0.2016748696565628, 0.20144756174087522, 0.2016748696565628, 1.0145593067162566, -34.79223343474723, 0.04058237226865027, 1.2521373065200122e-06, 0.0011189894130509066, 0.0008708684015274082, 0.0007342621684074402, 7, 7, 0.0, 1.2521373065200122e-06, 9.421976237082505e-10, 6.956436301762484e-12, 0.001431736350059526, 0.005554742898751379, 0.6724563078207381, 1.4369333230077599, 0.15287146776214056, 0.0009215214600165668, 0.0011250871555278405, 0.0008708684015274115, 0.0007026560565035381, 6,

                0.03346084795193747, -0.023684028163552286, 0.029596449559903704, 0.0011838579823961481, -0.00020467708818614483, 0.011572190302307717, 0.010783427231945097, 0.0054236918127231045, -106.1451065993863, 0.0002169476725089242, 0.00021554615278644119, 0.01468149014189095, 0.011648734165728092, 0.010578750143758952, 11, 13, 0.0, 0.00021554615278644119, 1.9642219329292554e-06, 1.3261793006909884e-07, 0.019126512634102255, 12.40139472825564, 0.6206977093432572, -0.1455549056578258, -0.38984518945275193, 0.018602573017657657, 0.016257534083706397, 0.011648734165728092, 0.008936058701834951, 17,
                0.03292677765712142, -0.022148005291819574, 0.022238554712384936, 0.0008895421884953975, -0.00034827496856451037, 0.006635513421148062, 0.003674882557243109, 0.0025197887705996173, -121.07614794822518, 0.0001007915508239847, 0.00010000026551887146, 0.01000001327593476, 0.006725794831514358, 0.0035773172974586484, 14, 14, 0.0, 0.00010000026551887146, 8.941282343109015e-07, 5.883009965913292e-08, 0.006679260823875665, 11.241752673753597, 0.894124673203925, 2.882978725034379, -0.5272072469836313, 0.012237881927285343, 0.012715745399677387, 0.006725794831514358, 0.007400266846759394, 21,
                0.018410714436322452, -0.020530906040221453, -0.011083740345202384, -0.00044334961380809533, -0.00078250098740682, 0.00529850104264915, 0.0038048958173021673, 0.001332147180140046, -122.58369866933465, 5.328588720560184e-05, 5.308932832553806e-05, 0.007286242400959363, 0.0052807670580968255, 0.0035506598069332536, 17, 17, 0.0, 5.308932832553806e-05, -2.8430589966465105e-08, 1.3068028921135629e-08, 0.0066247194423340264, -16.43452971205976, -0.07349791611438389, 1.636557236990705, -0.4173603786623366, 0.008599969585581372, 0.008873923687059495, 0.0052807670580968255, 0.0050202417873701525, 4,

                -0.0036018222570419313, -0.006878544390201568, -0.13426509052515032, -0.005370603621006013, -0.00545855313539505, 0.005370603621006013, 0.00545855313539505, 0.0007334213992300165, -113.69886403167907, 2.933685596920066e-05, 4.934727152377719e-07, 0.0007024761314363442, 0.0005280997610092162, 0.00044607967138290353, 14, 17, 0.0, 4.934727152377719e-07, 1.604537703802468e-10, 8.820959024372778e-13, 0.0007276028394699093, -0.1308002193065884, 0.4628659238951643, 0.6223425284252819, -0.5142881252199766, 0.0009425261989235877, 0.0007862413415122164, 0.0005280997610092162, 0.00046323142991358063, 3,
                0.009915336966514587, -0.0003056257963180542, 0.09896243512630462, 0.0039584974050521846, 0.003412303328514099, 0.003989832997322082, 0.003412303328514099, 0.0005453062588456438, -127.09922683680196, 2.181225035382575e-05, 6.142548648020864e-06, 0.0024784165606331924, 0.0019422607707977294, 0.0014006882905960088, 16, 16, 0.0, 6.142548648020864e-06, 7.653051047484626e-09, 1.1231705381855474e-10, 0.0025523573160171507, 0.626100337332549, 0.5027032617372239, -0.023207974657333263, -0.4281388798472499, 0.0033814636369546257, 0.0024556075983266667, 0.0019422607707977294, 0.001539536211409486, 5,
                0.003702890872955322, -0.00017798542976379394, 0.03901468515396118, 0.0015605874061584472, 0.0014915525913238525, 0.0015841960906982423, 0.0014915525913238525, 8.236126595875248e-05, -145.39555757523746, 3.2944506383500993e-06, 8.590175860897491e-07, 0.0009268320161117381, 0.0007476761627197267, 0.000497967004776001, 13, 13, 0.0, 8.590175860897491e-07, 7.674511469158585e-11, 2.005774192931313e-12, 0.0010509610176086426, 0.5938994589179943, 0.09639347946315382, -0.2818217733784074, -0.005646914734124159, 0.001117673267920812, 0.0007128977038509536, 0.0007476761627197267, 0.0005477206786222826, 1,
                0.011099897403299754, 0.005508623762693189, 0.181029696191282, 0.00724118784765128, 0.006902676309350385, 0.007241187847651281, 0.006902676309350385, 0.0013610889240344125, -107.38706967589988, 5.44435569613765e-05, 2.0087555164039103e-06, 0.0014173057243953792, 0.0011339809541009024, 0.0009391700136045017, 16, 16, 0.0, 2.0087555164039103e-06, 3.142417285805139e-09, 1.4190276309814502e-11, 0.0016288156134833445, 0.1957283465384882, 1.1037563914772262, 0.5167110591399013, -0.3854286919421451, 0.0018229108070161447, 0.001472438358481809, 0.0011339809541009022, 0.0008502015714760339, 8,

                -0.18784510021039527, 2.107534245252609, -0.32739771827120395, 1.6200032591819762, 0.4505746516642143, -0.48753098607063294, 0.32937262245199667, -0.009329101026058197, 0.09958629223623643, -0.0069311910271644605, -0.1935330405626272, 0.002397909998893737, 0.060726716770058135, 0.0002943157939007509, -0.4419180322627212, 0.0016272075962042436, -0.32414784334540153, 0.0013328918023034928,

                40.0, 40.0, 1000.0, 40.0, 40.0, 40.0, 40.0, 40000.0, 80.10299956639811, 1600.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                -117.0, -117.0, -2925.0, -117.0, -117.0, 117.0, 117.0, 342225.0, 103.40929308730803, 13689.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                748.360107421875, 748.360107421875, 18709.002685546875, 748.360107421875, 748.360107421875, 748.360107421875, 748.360107421875, 14001071.259512007, 143.70553143282618, 560042.8503804803, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56600,

                0, 1, 0, 0
            ],
            [
                1.8203834772109986, 1.817344880104065, 45.467236113548275, 1.818689444541931, 1.8183599352836608, 1.8186894445419313, 1.8183599352836608, 82.69079886515647, 12.987925147867177, 3.3076319546062587, 6.589180212504328e-07, 0.0008117376554345824, 0.0007296806335449446, 0.0008171081542966974, 5, 1, 0.0, 6.589180212504328e-07, 1.3753898564132127e-10, 8.576356055398741e-13, 0.0012707591056824175, 0.0004463310973023395, 0.25714538754931077, -1.024668307184627, 0.8700320916295162, 0.00036678810914358057, 0.0003225233762651819, 0.0007296806335449002, 0.0003556461644386818, 4,
                -0.28495741486549375, -0.291643550992012, -7.186864632368087, -0.2874745852947235, -0.28707133531570433, 0.28747458529472353, 0.28707133531570433, 2.0661526554301584, -27.070612512003297, 0.08264610621720633, 4.46902683305074e-06, 0.002114007292572743, 0.001803614282608037, 0.0014545023441314697, 3, 3, 0.0, 4.46902683305074e-06, -6.066172020116092e-09, 4.023124274813415e-11, 0.0032698869705199973, -0.007353718904943996, -0.6420890714436422, -0.985637983442238, 0.8979772909639896, 0.0007889673113822942, 0.0006512127030263216, 0.001803614282608026, 0.0011027249668993065, 11,
                0.20214893221855162, 0.2002106338739395, 5.0287485525012015, 0.20114994210004805, 0.20120994001626968, 0.2011499421000481, 0.20120994001626968, 1.0115383545902559, -34.824067464875675, 0.04046153418361023, 2.349767575516489e-07, 0.00048474401239380864, 0.00039852416038512975, 0.00028676241636277355, 3, 5, 0.0, 2.349767575516489e-07, -6.512501548756926e-12, 1.357113565249515e-13, 0.0006288602948189004, 0.002409864041386134, -0.05717556692866028, -0.5420877263970829, 0.8119381143397372, 0.00028332397341728394, 0.00019401458490665922, 0.00039852416038513197, 0.00027596240892732927, 3,

                0.01621608156710863, -0.019717880245298147, 0.027324342264910227, 0.0010929736905964092, 0.001133472443325445, 0.006048765169805847, 0.00396328535862267, 0.001600959886199939, -120.17363219694734, 6.403839544799756e-05, 6.284380395966163e-05, 0.007927408401215471, 0.005979716008352116, 0.003926822345238179, 11, 11, 0.0, 6.284380395966163e-05, -1.6128431654576735e-07, 1.3670480129033801e-08, 0.007725972993648611, 7.253064249780502, -0.32374154906426716, 0.4614561762408598, -0.378452919205364, 0.009610402989589298, 0.009255842267737353, 0.005979716008352116, 0.005204498094832879, 3,
                0.008490304462611675, -0.004760466888546944, 0.021972664073109625, 0.000878906562924385, -1.2237578630447388e-05, 0.002879299640655518, 0.0025564351119101046, 0.00033933632806613587, -139.61949028290744, 1.3573453122645435e-05, 1.280097637629388e-05, 0.0035778452141329254, 0.002931770444214344, 0.002544197533279657, 16, 18, 0.0, 1.280097637629388e-05, 2.1365373817687153e-08, 3.889677595495887e-10, 0.003684802819043398, 4.07079132761094, 0.46649377378194057, -0.6262913459135064, -0.4891709311308505, 0.004952421217846374, 0.0034956818808485773, 0.002931770444214344, 0.00205077995863162, 14,
                0.0031428650254383683, -0.004832183802500367, 0.0025682088453322645, 0.00010272835381329058, 0.0007360070012509823, 0.0016919757639989258, 0.0012560689123347402, 0.00010900922984192499, -145.02352087697653, 4.360369193677e-06, 4.349816078999813e-06, 0.0020856212693103732, 0.0016549935566261408, 0.0009204148314893245, 13, 11, 0.0, 4.349816078999813e-06, -8.014807031477207e-09, 5.4670161564258075e-11, 0.0016167253605090083, 20.302294273117653, -0.8834596707318261, -0.11059401021309245, -0.19952397690626136, 0.002641534019494429, 0.0018379473142587479, 0.0016549935566261408, 0.0012691778466888586, 4,

                -0.003642144799232483, -0.005673718452453613, -0.1160588636994362, -0.004642354547977448, -0.004628394544124603, 0.004642354547977447, 0.004628394544124603, 0.0005464937641320832, -116.81869637598871, 2.1859750565283328e-05, 3.0829481615644017e-07, 0.0005552430244104289, 0.00046441223621368396, 0.00046785622835159284, 14, 16, 0.0, 3.0829481615644017e-07, -2.795353884283808e-11, 2.0139568167595294e-13, 0.000896757841110229, -0.1196037525079453, -0.16330048054712215, -0.8810646342646318, -0.021585259409428664, 0.0006789129227399825, 0.00042963958219238376, 0.00046441223621368407, 0.00030432891911786095, 4,
                0.009011393785476685, -0.0024874597787857057, 0.09330787658691406, 0.0037323150634765625, 0.0038578838109970095, 0.004133160591125489, 0.0038578838109970095, 0.0005167341342620979, -121.73953848842147, 2.0669365370483917e-05, 6.73918963742986e-06, 0.0025959949224584125, 0.0018358443260192872, 0.0012506991624832153, 11, 11, 0.0, 6.73918963742986e-06, -9.4102997185325e-09, 1.6155978301387838e-10, 0.0024613946676254276, 0.6955454934290315, -0.5378881045098599, 0.5572788190402647, -0.324562706052825, 0.003101680800318718, 0.002786481314944216, 0.0018358443260192872, 0.0018354468796597326, 7,
                0.004539954662322998, 0.00012933611869812012, 0.0447968363761902, 0.001791873455047608, 0.001834028959274292, 0.001791873455047607, 0.001834028959274292, 0.00010822844074468205, -142.2752718917681, 4.329137629787282e-06, 1.118327150883033e-06, 0.0010575098821680264, 0.0008645175743103028, 0.0007970631122589111, 10, 10, 0.0, 1.118327150883033e-06, 7.633058340683328e-10, 3.721345152751404e-12, 0.0013568758964538573, 0.5901699582574204, 0.6454242495355346, -0.024484515204254986, 0.16256180544780063, 0.001013514151175817, 0.0009210758402729502, 0.0008645175743103027, 0.0006090455767770284, 3,
                0.0099447985399664, 0.005150750802767645, 0.16839250804460498, 0.006735700321784199, 0.006499762961522978, 0.006735700321784198, 0.006499762961522978, 0.0011714563391388632, -108.90039654363333, 4.685825356555453e-05, 1.4885947406707643e-06, 0.001220079809139863, 0.0009009503916841441, 0.0006488844689206, 11, 13, 0.0, 1.4885947406707643e-06, 2.3088322446146225e-09, 8.80325733175256e-12, 0.0011773136943385, 0.18113629627998054, 1.2712403191148074, 0.9727426841350022, -0.14885602324779915, 0.0013489383359636094, 0.001268721591316961, 0.0009009503916841444, 0.0008227290759387025, 7,

                0.23477527937845322, 2.1061640298366546, 0.2886475252162456, 1.617539502441883, 0.8201706781459265, -0.48862452739477163, 0.6243007310904234, -0.00837466961145401, 0.32392784483590054, -0.006434228003025054, 0.27742727110628035, 0.0019404416084289554, -0.033196874987561985, 0.00021406712767202418, -0.3569186884613236, 0.0009902453367831186, -0.36461443136766175, 0.0007761782091110944,

                40.0, 40.0, 1000.0, 40.0, 40.0, 40.0, 40.0, 40000.0, 80.10299956639811, 1600.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                -117.0, -117.0, -2925.0, -117.0, -117.0, 117.0, 117.0, 342225.0, 103.40929308730803, 13689.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                748.360107421875, 748.360107421875, 18709.002685546875, 748.360107421875, 748.360107421875, 748.360107421875, 748.360107421875, 14001071.259512007, 143.70553143282618, 560042.8503804803, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56604,

                0, 1, 0, 0
            ],
            [
                1.8171950221061706, 1.81565922498703, 45.415944600105284, 1.8166377840042114, 1.816690170764923, 1.8166377840042116, 1.816690170764923, 82.50432567366224, 12.963416518160239, 3.3001730269464895, 1.8867475792058458e-07, 0.00043436707739029275, 0.0003759663391113044, 0.00036416053771959334, 7, 7, 0.0, 1.8867475792058458e-07, -3.631508582449855e-11, 7.445674725639677e-14, 0.0007904648780823198, 0.00023910494497855593, -0.4431149194165585, -0.9084104821173469, 0.604409981204495, 0.00032953371604285686, 0.00024083945211264324, 0.000375966339111331, 0.00021754096114481113, 11,
                -0.2880585819482803, -0.3019863277673721, -7.354539173841475, -0.294181566953659, -0.29487221837043764, 0.29418156695365905, 0.29487221837043764, 2.163986884813747, -26.57131719122977, 0.08655947539254988, 1.668105723969807e-05, 0.00408424500240841, 0.003325566349029541, 0.0024896025657653587, 3, 1, 0.0, 1.668105723969807e-05, -1.1038803627233157e-08, 5.920166647487736e-10, 0.006558617949485757, -0.013883415758172847, -0.16202672308859506, -0.8724156520116404, 0.9511335299042175, 0.0010291191438833909, 0.0007634197103501803, 0.0033255663490295473, 0.0023710052083241737, 2,
                0.2030332624912262, 0.2002712219953537, 5.0398898646235475, 0.2015955945849419, 0.201358799636364, 0.20159559458494186, 0.201358799636364, 1.0160345434750069, -34.77610775995831, 0.040641381739000275, 5.979829440436261e-07, 0.0007732935691208263, 0.0006380766153335538, 0.00047987550497052833, 7, 5, 0.0, 5.979829440436261e-07, 1.4564043638832944e-10, 8.034327485672286e-13, 0.0009881749749183766, 0.003835865415179004, 0.3149551949038986, -0.7531610915724376, 0.7825627027481976, 0.0004446402192115779, 0.0003346009655224093, 0.0006380766153335571, 0.0004368537249561895, 2,

                0.012768699222942815, -0.01732542933896184, -0.0043720768269849926, -0.0001748830730793997, -0.00010899857152253389, 0.005731375659699551, 0.005213115317746997, 0.0012630836307890234, -121.94809198250763, 5.052334523156093e-05, 5.0492761142311224e-05, 0.007105825859272884, 0.005729651096900925, 0.005104116746224463, 14, 14, 0.0, 5.0492761142311224e-05, -6.346906437570192e-08, 7.0706577929712455e-09, 0.009883452008944006, -40.63186753383917, -0.1768961642102424, -0.22666981761013805, -0.06701477358714569, 0.008847367060904313, 0.005247220570033545, 0.005729651096900925, 0.004202839450906167, 10,
                0.006784123461693525, -0.009163258224725723, 0.020526806078851226, 0.000821072243154049, 0.00129984924569726, 0.003353645801544189, 0.0026597918011248113, 0.0004416851707854945, -133.8900580828401, 1.766740683141978e-05, 1.6993247202941756e-05, 0.0041222866473526265, 0.0032411989045143127, 0.002553305961191654, 14, 14, 0.0, 1.6993247202941756e-05, -4.671786705755997e-08, 8.297139532573719e-10, 0.005802974477410316, 5.020613815317108, -0.6669118645295135, -0.1267352604121612, -0.2553430068444175, 0.005350244095704208, 0.0038402839301957164, 0.003241198904514313, 0.0025471311046581365, 3,
                0.0040593120618723335, -0.0047900791512802245, 0.0012450700276531272, 4.980280110612509e-05, -0.00017657867865636945, 0.002036342873703689, 0.001781883300282061, 0.00014354597509004652, -142.56218529488365, 5.741839003601861e-06, 5.739358684603844e-06, 0.002395695866466327, 0.0020409288607165215, 0.0019406989100389182, 15, 13, 0.0, 5.739358684603844e-06, -2.1311791614702925e-09, 7.096181007375963e-11, 0.003989415033720434, 48.10363700951928, -0.15499757745224846, -0.8457408281132315, -0.33535517083257144, 0.0030790702318578647, 0.0023096020531894424, 0.0020409288607165215, 0.0012545788417226732, 17,

                -0.0025835022330284118, -0.006283867359161377, -0.10373813509941099, -0.004149525403976439, -0.004147784411907196, 0.00414952540397644, 0.004147784411907196, 0.00044482562438793235, -119.46700725209769, 1.7793024975517294e-05, 5.744638972714497e-07, 0.0007579339663001321, 0.0005901338672637939, 0.000445441901683807, 12, 12, 0.0, 5.744638972714497e-07, -1.6791201433758746e-10, 1.2872135254037348e-12, 0.0008905664086341861, -0.18265557925583809, -0.3856449611884827, 0.9005433954308302, -0.3822876532530051, 0.0008960117275516192, 0.0008494318131008846, 0.0005901338672637938, 0.00047561109741019354, 7,
                0.008207324147224426, 0.002160823345184326, 0.10200092792510985, 0.004080037117004394, 0.004191341996192932, 0.004080037117004395, 0.004191341996192932, 0.0004548357016799365, -120.39098684304126, 1.819342806719746e-05, 1.5467251910639276e-06, 0.0012436740694667264, 0.0009301527404785155, 0.0007350891828536987, 14, 14, 0.0, 1.5467251910639276e-06, 2.39537089252303e-09, 1.3377446531410702e-11, 0.0014091432094573975, 0.30481930281552067, 1.2452399050785967, 2.5917391815085065, -0.1965089835224695, 0.0014416523277759553, 0.0008779874629608159, 0.0009301527404785157, 0.0008255550075217488, 13,
                0.005128306150436401, -0.00015306472778320312, 0.052766692638397214, 0.0021106677055358885, 0.0020530760288238526, 0.002122912883758545, 0.0020530760288238526, 0.00013381465703140804, -136.36582248439814, 5.352586281256321e-06, 8.976681180641891e-07, 0.0009474534912406988, 0.000619707546234131, 0.00037851929664611816, 16, 16, 0.0, 8.976681180641891e-07, 8.449318691035146e-10, 5.021519094706431e-12, 0.00071524977684021, 0.44888804085821027, 0.9934545194168617, 3.2316566501529156, -0.27390518406224396, 0.0011035496989885965, 0.0010627078025750043, 0.0006197075462341309, 0.000716680315904282, 15,
                0.008979416483362295, 0.0045065389928858595, 0.15826312452415148, 0.006330524980966059, 0.006274051060658584, 0.006330524980966059, 0.006274051060658584, 0.001033475983099277, -110.27082930109057, 4.133903932397108e-05, 1.2634927893357446e-06, 0.0011240519513508905, 0.0008846449785541674, 0.0005325860261006553, 12, 12, 0.0, 1.2634927893357446e-06, 4.606943010776707e-10, 4.291832640202857e-12, 0.0009590257924299329, 0.17756062170682035, 0.32437971528173964, -0.3115792250406315, -0.3881685359569506, 0.001365988688849456, 0.001110852813423099, 0.0008846449785541674, 0.0006934666908039932, 3,

                -0.0023788283232629047, 2.1108193509578705, -0.5541077236125567, 1.6150421894192697, -0.3463852157093954, -0.4957771615386009, 0.0802848099438015, -0.008229562520980834, 0.17891330512463116, -0.006260193109512329, 0.19682223116114939, 0.001969369411468506, 0.7926486456657376, -0.0009959553162334485, -0.062226594680563165, -0.0002246858741855249, 0.03868440978941439, 0.0007712694420479235,

                40.0, 40.0, 1000.0, 40.0, 40.0, 40.0, 40.0, 40000.0, 80.10299956639811, 1600.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                -117.0, -117.0, -2925.0, -117.0, -117.0, 117.0, 117.0, 342225.0, 103.40929308730803, 13689.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                748.360107421875, 748.360107421875, 18709.002685546875, 748.360107421875, 748.360107421875, 748.360107421875, 748.360107421875, 14001071.259512007, 143.70553143282618, 560042.8503804803, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56609,

                0, 1, 0, 0
            ]
        ]
        expected_y_data = [
            'Coding',
            'Coding',
            'Coding'
        ]

        # act
        actual_x_data, actual_y_data = extract_features(test_data_basename, test_al)

        # assert
        self.assertEqual(len(actual_x_data), len(expected_x_data))

        for point_index, actual_x_point in enumerate(actual_x_data):
            expected_x_point = expected_x_data[point_index]

            self.assertEqual(len(actual_x_point), len(expected_x_point))

            for f_index, actual_value in enumerate(actual_x_point):
                expected_value = expected_x_point[f_index]

                self.assertAlmostEqual(actual_value, expected_value, places=8)

        self.assertEqual(actual_y_data, expected_y_data)

    @patch('features.load_clusters')
    def test_extractfeatures_withpersonfeatures_withabsolutegpsstatisticalfeatures(self, load_clusters_mock):
        """
        Test extract_features with lowpass filtering off but person and location features on.
        Also enable absolute GPS statistical features.
        """

        # arrange
        test_config = Config(description='test')
        test_config.datapath = './test_data/'  # point to the test data directory

        test_config.translate = True
        test_config.filter_data = False
        test_config.fftfeatures = 0
        test_config.sfeatures = 1
        test_config.gen_gps_abs_stat_features = True

        test_config.samplerate = 5  # 5Hz test data
        test_config.samplesize = test_config.samplerate * test_config.numseconds
        test_config.windowsize = test_config.samplesize * test_config.numsensors

        test_al = AL(conf=test_config)

        # Set up test mapping/location values
        test_al.aclass.amappings['Work'] = 'Coding'
        test_al.location.lmappings['motorway'] = 'road'
        test_al.location.locations.append([40.0, -117.0, 'motorway', 'administrative', 'boundary'])

        test_data_basename = 'extract_features_1'

        # Override the load_clusters function to load mock clusters:
        test_clusters = [Mock(spec=KMeans) for _ in range(5)]
        test_clusters[0].predict.return_value = np.array([1, 0, 0, 0, 0])
        test_clusters[1].predict.return_value = np.array([1, 0, 0, 2, 2])
        test_clusters[2].predict.return_value = np.array([2, 1, 1, 2, 2])
        test_clusters[3].predict.return_value = np.array([1, 1, 1, 1, 1])
        test_clusters[4].predict.return_value = np.array([2, 2, 2, 1, 0])

        load_clusters_mock.return_value = test_clusters

        expected_x_data = [
            [

                1.8231455326080321, 1.8186726808547973, 45.53627052307128, 1.8214508209228513, 1.8214417815208435, 1.8214508209228515, 1.8214417815208435, 82.94210665092187, 13.020868651100015, 3.317684266036875, 1.1729963449911204e-06, 0.0010830495579571234, 0.0008600555801391519, 0.0006173372268676314, 9, 9, 0.0, 1.1729963449911204e-06, -4.798868024981334e-10, 4.241837341899848e-12, 0.0012050986289977583, 0.0005946081802024106, -0.37774073248260204, 0.0829089122517992, 0.05612991594261147, 0.0010161643226941168, 0.0009241473558045313, 0.000860055580139143, 0.0006582558348109362, 8,
                -0.28015519082546236, -0.290841269493103, -7.152085608243943, -0.2860834243297577, -0.28541713058948515, 0.2860834243297577, 0.28541713058948515, 2.0462693489190147, -27.176301122165018, 0.08185077395676059, 7.048280520397238e-06, 0.0026548597929829058, 0.0021927347660064722, 0.0021347135305405107, 6, 4, 0.0, 7.048280520397238e-06, 2.498918740908194e-09, 1.2643493628796293e-10, 0.003398019075393721, -0.00928001962785075, 0.13354491721264125, -0.4549241332259828, 0.8711322421894913, 0.0013229637096325644, 0.0010420670683976133, 0.0021927347660064722, 0.0014967280201639106, 2,
                0.20482647716999053, 0.19922617226839065, 5.03618904352188, 0.2014475617408752, 0.2016748696565628, 0.20144756174087522, 0.2016748696565628, 1.0145593067162566, -34.79223343474723, 0.04058237226865027, 1.2521373065200122e-06, 0.0011189894130509066, 0.0008708684015274082, 0.0007342621684074402, 7, 7, 0.0, 1.2521373065200122e-06, 9.421976237082505e-10, 6.956436301762484e-12, 0.001431736350059526, 0.005554742898751379, 0.6724563078207381, 1.4369333230077599, 0.15287146776214056, 0.0009215214600165668, 0.0011250871555278405, 0.0008708684015274115, 0.0007026560565035381, 6,

                0.03346084795193747, -0.023684028163552286, 0.029596449559903704, 0.0011838579823961481, -0.00020467708818614483, 0.011572190302307717, 0.010783427231945097, 0.0054236918127231045, -106.1451065993863, 0.0002169476725089242, 0.00021554615278644119, 0.01468149014189095, 0.011648734165728092, 0.010578750143758952, 11, 13, 0.0, 0.00021554615278644119, 1.9642219329292554e-06, 1.3261793006909884e-07, 0.019126512634102255, 12.40139472825564, 0.6206977093432572, -0.1455549056578258, -0.38984518945275193, 0.018602573017657657, 0.016257534083706397, 0.011648734165728092, 0.008936058701834951, 17,
                0.03292677765712142, -0.022148005291819574, 0.022238554712384936, 0.0008895421884953975, -0.00034827496856451037, 0.006635513421148062, 0.003674882557243109, 0.0025197887705996173, -121.07614794822518, 0.0001007915508239847, 0.00010000026551887146, 0.01000001327593476, 0.006725794831514358, 0.0035773172974586484, 14, 14, 0.0, 0.00010000026551887146, 8.941282343109015e-07, 5.883009965913292e-08, 0.006679260823875665, 11.241752673753597, 0.894124673203925, 2.882978725034379, -0.5272072469836313, 0.012237881927285343, 0.012715745399677387, 0.006725794831514358, 0.007400266846759394, 21,
                0.018410714436322452, -0.020530906040221453, -0.011083740345202384, -0.00044334961380809533, -0.00078250098740682, 0.00529850104264915, 0.0038048958173021673, 0.001332147180140046, -122.58369866933465, 5.328588720560184e-05, 5.308932832553806e-05, 0.007286242400959363, 0.0052807670580968255, 0.0035506598069332536, 17, 17, 0.0, 5.308932832553806e-05, -2.8430589966465105e-08, 1.3068028921135629e-08, 0.0066247194423340264, -16.43452971205976, -0.07349791611438389, 1.636557236990705, -0.4173603786623366, 0.008599969585581372, 0.008873923687059495, 0.0052807670580968255, 0.0050202417873701525, 4,

                -0.0036018222570419313, -0.006878544390201568, -0.13426509052515032, -0.005370603621006013, -0.00545855313539505, 0.005370603621006013, 0.00545855313539505, 0.0007334213992300165, -113.69886403167907, 2.933685596920066e-05, 4.934727152377719e-07, 0.0007024761314363442, 0.0005280997610092162, 0.00044607967138290353, 14, 17, 0.0, 4.934727152377719e-07, 1.604537703802468e-10, 8.820959024372778e-13, 0.0007276028394699093, -0.1308002193065884, 0.4628659238951643, 0.6223425284252819, -0.5142881252199766, 0.0009425261989235877, 0.0007862413415122164, 0.0005280997610092162, 0.00046323142991358063, 3,
                0.009915336966514587, -0.0003056257963180542, 0.09896243512630462, 0.0039584974050521846, 0.003412303328514099, 0.003989832997322082, 0.003412303328514099, 0.0005453062588456438, -127.09922683680196, 2.181225035382575e-05, 6.142548648020864e-06, 0.0024784165606331924, 0.0019422607707977294, 0.0014006882905960088, 16, 16, 0.0, 6.142548648020864e-06, 7.653051047484626e-09, 1.1231705381855474e-10, 0.0025523573160171507, 0.626100337332549, 0.5027032617372239, -0.023207974657333263, -0.4281388798472499, 0.0033814636369546257, 0.0024556075983266667, 0.0019422607707977294, 0.001539536211409486, 5,
                0.003702890872955322, -0.00017798542976379394, 0.03901468515396118, 0.0015605874061584472, 0.0014915525913238525, 0.0015841960906982423, 0.0014915525913238525, 8.236126595875248e-05, -145.39555757523746, 3.2944506383500993e-06, 8.590175860897491e-07, 0.0009268320161117381, 0.0007476761627197267, 0.000497967004776001, 13, 13, 0.0, 8.590175860897491e-07, 7.674511469158585e-11, 2.005774192931313e-12, 0.0010509610176086426, 0.5938994589179943, 0.09639347946315382, -0.2818217733784074, -0.005646914734124159, 0.001117673267920812, 0.0007128977038509536, 0.0007476761627197267, 0.0005477206786222826, 1,
                0.011099897403299754, 0.005508623762693189, 0.181029696191282, 0.00724118784765128, 0.006902676309350385, 0.007241187847651281, 0.006902676309350385, 0.0013610889240344125, -107.38706967589988, 5.44435569613765e-05, 2.0087555164039103e-06, 0.0014173057243953792, 0.0011339809541009024, 0.0009391700136045017, 16, 16, 0.0, 2.0087555164039103e-06, 3.142417285805139e-09, 1.4190276309814502e-11, 0.0016288156134833445, 0.1957283465384882, 1.1037563914772262, 0.5167110591399013, -0.3854286919421451, 0.0018229108070161447, 0.001472438358481809, 0.0011339809541009022, 0.0008502015714760339, 8,

                -0.18784510021039527, 2.107534245252609, -0.32739771827120395, 1.6200032591819762, 0.4505746516642143, -0.48753098607063294, 0.32937262245199667, -0.009329101026058197, 0.09958629223623643, -0.0069311910271644605, -0.1935330405626272, 0.002397909998893737, 0.060726716770058135, 0.0002943157939007509, -0.4419180322627212, 0.0016272075962042436, -0.32414784334540153, 0.0013328918023034928,

                40.0, 40.0, 1000.0, 40.0, 40.0, 40.0, 40.0, 40000.0, 80.10299956639811, 1600.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                -117.0, -117.0, -2925.0, -117.0, -117.0, 117.0, 117.0, 342225.0, 103.40929308730803, 13689.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                748.360107421875, 748.360107421875, 18709.002685546875, 748.360107421875, 748.360107421875, 748.360107421875, 748.360107421875, 14001071.259512007, 143.70553143282618, 560042.8503804803, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56600,

                0.0, 0.0, 0.0, 0, 0, 2, 1, 2,

                0, 1, 0, 0
            ],
            [
                1.8203834772109986, 1.817344880104065, 45.467236113548275, 1.818689444541931, 1.8183599352836608, 1.8186894445419313, 1.8183599352836608, 82.69079886515647, 12.987925147867177, 3.3076319546062587, 6.589180212504328e-07, 0.0008117376554345824, 0.0007296806335449446, 0.0008171081542966974, 5, 1, 0.0, 6.589180212504328e-07, 1.3753898564132127e-10, 8.576356055398741e-13, 0.0012707591056824175, 0.0004463310973023395, 0.25714538754931077, -1.024668307184627, 0.8700320916295162, 0.00036678810914358057, 0.0003225233762651819, 0.0007296806335449002, 0.0003556461644386818, 4,
                -0.28495741486549375, -0.291643550992012, -7.186864632368087, -0.2874745852947235, -0.28707133531570433, 0.28747458529472353, 0.28707133531570433, 2.0661526554301584, -27.070612512003297, 0.08264610621720633, 4.46902683305074e-06, 0.002114007292572743, 0.001803614282608037, 0.0014545023441314697, 3, 3, 0.0, 4.46902683305074e-06, -6.066172020116092e-09, 4.023124274813415e-11, 0.0032698869705199973, -0.007353718904943996, -0.6420890714436422, -0.985637983442238, 0.8979772909639896, 0.0007889673113822942, 0.0006512127030263216, 0.001803614282608026, 0.0011027249668993065, 11,
                0.20214893221855162, 0.2002106338739395, 5.0287485525012015, 0.20114994210004805, 0.20120994001626968, 0.2011499421000481, 0.20120994001626968, 1.0115383545902559, -34.824067464875675, 0.04046153418361023, 2.349767575516489e-07, 0.00048474401239380864, 0.00039852416038512975, 0.00028676241636277355, 3, 5, 0.0, 2.349767575516489e-07, -6.512501548756926e-12, 1.357113565249515e-13, 0.0006288602948189004, 0.002409864041386134, -0.05717556692866028, -0.5420877263970829, 0.8119381143397372, 0.00028332397341728394, 0.00019401458490665922, 0.00039852416038513197, 0.00027596240892732927, 3,

                0.01621608156710863, -0.019717880245298147, 0.027324342264910227, 0.0010929736905964092, 0.001133472443325445, 0.006048765169805847, 0.00396328535862267, 0.001600959886199939, -120.17363219694734, 6.403839544799756e-05, 6.284380395966163e-05, 0.007927408401215471, 0.005979716008352116, 0.003926822345238179, 11, 11, 0.0, 6.284380395966163e-05, -1.6128431654576735e-07, 1.3670480129033801e-08, 0.007725972993648611, 7.253064249780502, -0.32374154906426716, 0.4614561762408598, -0.378452919205364, 0.009610402989589298, 0.009255842267737353, 0.005979716008352116, 0.005204498094832879, 3,
                0.008490304462611675, -0.004760466888546944, 0.021972664073109625, 0.000878906562924385, -1.2237578630447388e-05, 0.002879299640655518, 0.0025564351119101046, 0.00033933632806613587, -139.61949028290744, 1.3573453122645435e-05, 1.280097637629388e-05, 0.0035778452141329254, 0.002931770444214344, 0.002544197533279657, 16, 18, 0.0, 1.280097637629388e-05, 2.1365373817687153e-08, 3.889677595495887e-10, 0.003684802819043398, 4.07079132761094, 0.46649377378194057, -0.6262913459135064, -0.4891709311308505, 0.004952421217846374, 0.0034956818808485773, 0.002931770444214344, 0.00205077995863162, 14,
                0.0031428650254383683, -0.004832183802500367, 0.0025682088453322645, 0.00010272835381329058, 0.0007360070012509823, 0.0016919757639989258, 0.0012560689123347402, 0.00010900922984192499, -145.02352087697653, 4.360369193677e-06, 4.349816078999813e-06, 0.0020856212693103732, 0.0016549935566261408, 0.0009204148314893245, 13, 11, 0.0, 4.349816078999813e-06, -8.014807031477207e-09, 5.4670161564258075e-11, 0.0016167253605090083, 20.302294273117653, -0.8834596707318261, -0.11059401021309245, -0.19952397690626136, 0.002641534019494429, 0.0018379473142587479, 0.0016549935566261408, 0.0012691778466888586, 4,

                -0.003642144799232483, -0.005673718452453613, -0.1160588636994362, -0.004642354547977448, -0.004628394544124603, 0.004642354547977447, 0.004628394544124603, 0.0005464937641320832, -116.81869637598871, 2.1859750565283328e-05, 3.0829481615644017e-07, 0.0005552430244104289, 0.00046441223621368396, 0.00046785622835159284, 14, 16, 0.0, 3.0829481615644017e-07, -2.795353884283808e-11, 2.0139568167595294e-13, 0.000896757841110229, -0.1196037525079453, -0.16330048054712215, -0.8810646342646318, -0.021585259409428664, 0.0006789129227399825, 0.00042963958219238376, 0.00046441223621368407, 0.00030432891911786095, 4,
                0.009011393785476685, -0.0024874597787857057, 0.09330787658691406, 0.0037323150634765625, 0.0038578838109970095, 0.004133160591125489, 0.0038578838109970095, 0.0005167341342620979, -121.73953848842147, 2.0669365370483917e-05, 6.73918963742986e-06, 0.0025959949224584125, 0.0018358443260192872, 0.0012506991624832153, 11, 11, 0.0, 6.73918963742986e-06, -9.4102997185325e-09, 1.6155978301387838e-10, 0.0024613946676254276, 0.6955454934290315, -0.5378881045098599, 0.5572788190402647, -0.324562706052825, 0.003101680800318718, 0.002786481314944216, 0.0018358443260192872, 0.0018354468796597326, 7,
                0.004539954662322998, 0.00012933611869812012, 0.0447968363761902, 0.001791873455047608, 0.001834028959274292, 0.001791873455047607, 0.001834028959274292, 0.00010822844074468205, -142.2752718917681, 4.329137629787282e-06, 1.118327150883033e-06, 0.0010575098821680264, 0.0008645175743103028, 0.0007970631122589111, 10, 10, 0.0, 1.118327150883033e-06, 7.633058340683328e-10, 3.721345152751404e-12, 0.0013568758964538573, 0.5901699582574204, 0.6454242495355346, -0.024484515204254986, 0.16256180544780063, 0.001013514151175817, 0.0009210758402729502, 0.0008645175743103027, 0.0006090455767770284, 3,
                0.0099447985399664, 0.005150750802767645, 0.16839250804460498, 0.006735700321784199, 0.006499762961522978, 0.006735700321784198, 0.006499762961522978, 0.0011714563391388632, -108.90039654363333, 4.685825356555453e-05, 1.4885947406707643e-06, 0.001220079809139863, 0.0009009503916841441, 0.0006488844689206, 11, 13, 0.0, 1.4885947406707643e-06, 2.3088322446146225e-09, 8.80325733175256e-12, 0.0011773136943385, 0.18113629627998054, 1.2712403191148074, 0.9727426841350022, -0.14885602324779915, 0.0013489383359636094, 0.001268721591316961, 0.0009009503916841444, 0.0008227290759387025, 7,

                0.23477527937845322, 2.1061640298366546, 0.2886475252162456, 1.617539502441883, 0.8201706781459265, -0.48862452739477163, 0.6243007310904234, -0.00837466961145401, 0.32392784483590054, -0.006434228003025054, 0.27742727110628035, 0.0019404416084289554, -0.033196874987561985, 0.00021406712767202418, -0.3569186884613236, 0.0009902453367831186, -0.36461443136766175, 0.0007761782091110944,

                40.0, 40.0, 1000.0, 40.0, 40.0, 40.0, 40.0, 40000.0, 80.10299956639811, 1600.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                -117.0, -117.0, -2925.0, -117.0, -117.0, 117.0, 117.0, 342225.0, 103.40929308730803, 13689.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                748.360107421875, 748.360107421875, 18709.002685546875, 748.360107421875, 748.360107421875, 748.360107421875, 748.360107421875, 14001071.259512007, 143.70553143282618, 560042.8503804803, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56604,

                0.0, 0.0, 0.0, 0, 0, 2, 1, 2,

                0, 1, 0, 0
            ],
            [
                1.8171950221061706, 1.81565922498703, 45.415944600105284, 1.8166377840042114, 1.816690170764923, 1.8166377840042116, 1.816690170764923, 82.50432567366224, 12.963416518160239, 3.3001730269464895, 1.8867475792058458e-07, 0.00043436707739029275, 0.0003759663391113044, 0.00036416053771959334, 7, 7, 0.0, 1.8867475792058458e-07, -3.631508582449855e-11, 7.445674725639677e-14, 0.0007904648780823198, 0.00023910494497855593, -0.4431149194165585, -0.9084104821173469, 0.604409981204495, 0.00032953371604285686, 0.00024083945211264324, 0.000375966339111331, 0.00021754096114481113, 11,
                -0.2880585819482803, -0.3019863277673721, -7.354539173841475, -0.294181566953659, -0.29487221837043764, 0.29418156695365905, 0.29487221837043764, 2.163986884813747, -26.57131719122977, 0.08655947539254988, 1.668105723969807e-05, 0.00408424500240841, 0.003325566349029541, 0.0024896025657653587, 3, 1, 0.0, 1.668105723969807e-05, -1.1038803627233157e-08, 5.920166647487736e-10, 0.006558617949485757, -0.013883415758172847, -0.16202672308859506, -0.8724156520116404, 0.9511335299042175, 0.0010291191438833909, 0.0007634197103501803, 0.0033255663490295473, 0.0023710052083241737, 2,
                0.2030332624912262, 0.2002712219953537, 5.0398898646235475, 0.2015955945849419, 0.201358799636364, 0.20159559458494186, 0.201358799636364, 1.0160345434750069, -34.77610775995831, 0.040641381739000275, 5.979829440436261e-07, 0.0007732935691208263, 0.0006380766153335538, 0.00047987550497052833, 7, 5, 0.0, 5.979829440436261e-07, 1.4564043638832944e-10, 8.034327485672286e-13, 0.0009881749749183766, 0.003835865415179004, 0.3149551949038986, -0.7531610915724376, 0.7825627027481976, 0.0004446402192115779, 0.0003346009655224093, 0.0006380766153335571, 0.0004368537249561895, 2,

                0.012768699222942815, -0.01732542933896184, -0.0043720768269849926, -0.0001748830730793997, -0.00010899857152253389, 0.005731375659699551, 0.005213115317746997, 0.0012630836307890234, -121.94809198250763, 5.052334523156093e-05, 5.0492761142311224e-05, 0.007105825859272884, 0.005729651096900925, 0.005104116746224463, 14, 14, 0.0, 5.0492761142311224e-05, -6.346906437570192e-08, 7.0706577929712455e-09, 0.009883452008944006, -40.63186753383917, -0.1768961642102424, -0.22666981761013805, -0.06701477358714569, 0.008847367060904313, 0.005247220570033545, 0.005729651096900925, 0.004202839450906167, 10,
                0.006784123461693525, -0.009163258224725723, 0.020526806078851226, 0.000821072243154049, 0.00129984924569726, 0.003353645801544189, 0.0026597918011248113, 0.0004416851707854945, -133.8900580828401, 1.766740683141978e-05, 1.6993247202941756e-05, 0.0041222866473526265, 0.0032411989045143127, 0.002553305961191654, 14, 14, 0.0, 1.6993247202941756e-05, -4.671786705755997e-08, 8.297139532573719e-10, 0.005802974477410316, 5.020613815317108, -0.6669118645295135, -0.1267352604121612, -0.2553430068444175, 0.005350244095704208, 0.0038402839301957164, 0.003241198904514313, 0.0025471311046581365, 3,
                0.0040593120618723335, -0.0047900791512802245, 0.0012450700276531272, 4.980280110612509e-05, -0.00017657867865636945, 0.002036342873703689, 0.001781883300282061, 0.00014354597509004652, -142.56218529488365, 5.741839003601861e-06, 5.739358684603844e-06, 0.002395695866466327, 0.0020409288607165215, 0.0019406989100389182, 15, 13, 0.0, 5.739358684603844e-06, -2.1311791614702925e-09, 7.096181007375963e-11, 0.003989415033720434, 48.10363700951928, -0.15499757745224846, -0.8457408281132315, -0.33535517083257144, 0.0030790702318578647, 0.0023096020531894424, 0.0020409288607165215, 0.0012545788417226732, 17,

                -0.0025835022330284118, -0.006283867359161377, -0.10373813509941099, -0.004149525403976439, -0.004147784411907196, 0.00414952540397644, 0.004147784411907196, 0.00044482562438793235, -119.46700725209769, 1.7793024975517294e-05, 5.744638972714497e-07, 0.0007579339663001321, 0.0005901338672637939, 0.000445441901683807, 12, 12, 0.0, 5.744638972714497e-07, -1.6791201433758746e-10, 1.2872135254037348e-12, 0.0008905664086341861, -0.18265557925583809, -0.3856449611884827, 0.9005433954308302, -0.3822876532530051, 0.0008960117275516192, 0.0008494318131008846, 0.0005901338672637938, 0.00047561109741019354, 7,
                0.008207324147224426, 0.002160823345184326, 0.10200092792510985, 0.004080037117004394, 0.004191341996192932, 0.004080037117004395, 0.004191341996192932, 0.0004548357016799365, -120.39098684304126, 1.819342806719746e-05, 1.5467251910639276e-06, 0.0012436740694667264, 0.0009301527404785155, 0.0007350891828536987, 14, 14, 0.0, 1.5467251910639276e-06, 2.39537089252303e-09, 1.3377446531410702e-11, 0.0014091432094573975, 0.30481930281552067, 1.2452399050785967, 2.5917391815085065, -0.1965089835224695, 0.0014416523277759553, 0.0008779874629608159, 0.0009301527404785157, 0.0008255550075217488, 13,
                0.005128306150436401, -0.00015306472778320312, 0.052766692638397214, 0.0021106677055358885, 0.0020530760288238526, 0.002122912883758545, 0.0020530760288238526, 0.00013381465703140804, -136.36582248439814, 5.352586281256321e-06, 8.976681180641891e-07, 0.0009474534912406988, 0.000619707546234131, 0.00037851929664611816, 16, 16, 0.0, 8.976681180641891e-07, 8.449318691035146e-10, 5.021519094706431e-12, 0.00071524977684021, 0.44888804085821027, 0.9934545194168617, 3.2316566501529156, -0.27390518406224396, 0.0011035496989885965, 0.0010627078025750043, 0.0006197075462341309, 0.000716680315904282, 15,
                0.008979416483362295, 0.0045065389928858595, 0.15826312452415148, 0.006330524980966059, 0.006274051060658584, 0.006330524980966059, 0.006274051060658584, 0.001033475983099277, -110.27082930109057, 4.133903932397108e-05, 1.2634927893357446e-06, 0.0011240519513508905, 0.0008846449785541674, 0.0005325860261006553, 12, 12, 0.0, 1.2634927893357446e-06, 4.606943010776707e-10, 4.291832640202857e-12, 0.0009590257924299329, 0.17756062170682035, 0.32437971528173964, -0.3115792250406315, -0.3881685359569506, 0.001365988688849456, 0.001110852813423099, 0.0008846449785541674, 0.0006934666908039932, 3,

                -0.0023788283232629047, 2.1108193509578705, -0.5541077236125567, 1.6150421894192697, -0.3463852157093954, -0.4957771615386009, 0.0802848099438015, -0.008229562520980834, 0.17891330512463116, -0.006260193109512329, 0.19682223116114939, 0.001969369411468506, 0.7926486456657376, -0.0009959553162334485, -0.062226594680563165, -0.0002246858741855249, 0.03868440978941439, 0.0007712694420479235,

                40.0, 40.0, 1000.0, 40.0, 40.0, 40.0, 40.0, 40000.0, 80.10299956639811, 1600.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                -117.0, -117.0, -2925.0, -117.0, -117.0, 117.0, 117.0, 342225.0, 103.40929308730803, 13689.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                748.360107421875, 748.360107421875, 18709.002685546875, 748.360107421875, 748.360107421875, 748.360107421875, 748.360107421875, 14001071.259512007, 143.70553143282618, 560042.8503804803, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56609,

                0.0, 0.0, 0.0, 0, 0, 2, 1, 2,

                0, 1, 0, 0
            ]
        ]
        expected_y_data = [
            'Coding',
            'Coding',
            'Coding'
        ]

        # act
        actual_x_data, actual_y_data = extract_features(test_data_basename, test_al)

        # assert
        self.assertEqual(len(actual_x_data), len(expected_x_data))

        for point_index, actual_x_point in enumerate(actual_x_data):
            expected_x_point = expected_x_data[point_index]

            self.assertEqual(len(actual_x_point), len(expected_x_point))

            for f_index, actual_value in enumerate(actual_x_point):
                expected_value = expected_x_point[f_index]

                self.assertAlmostEqual(actual_value, expected_value, places=8)

        self.assertEqual(actual_y_data, expected_y_data)

    @patch('features.load_clusters')
    def test_extractfeatures_withpersonfeatures_noabsolutegpsstatisticalfeatures(self, load_clusters_mock):
        """
        Test extract_features with lowpass filtering off but person and location features on.
        Also DISABLE absolute GPS statistical features.
        """

        # arrange
        test_config = Config(description='test')
        test_config.datapath = './test_data/'  # point to the test data directory

        test_config.translate = True
        test_config.filter_data = False
        test_config.fftfeatures = 0
        test_config.sfeatures = 1
        test_config.gen_gps_abs_stat_features = False

        test_config.samplerate = 5  # 5Hz test data
        test_config.samplesize = test_config.samplerate * test_config.numseconds
        test_config.windowsize = test_config.samplesize * test_config.numsensors

        test_al = AL(conf=test_config)

        # Set up test mapping/location values
        test_al.aclass.amappings['Work'] = 'Coding'
        test_al.location.lmappings['motorway'] = 'road'
        test_al.location.locations.append([40.0, -117.0, 'motorway', 'administrative', 'boundary'])

        test_data_basename = 'extract_features_1'

        # Override the load_clusters function to load mock clusters:
        test_clusters = [Mock(spec=KMeans) for _ in range(5)]
        test_clusters[0].predict.return_value = np.array([1, 0, 0, 0, 0])
        test_clusters[1].predict.return_value = np.array([1, 0, 0, 2, 2])
        test_clusters[2].predict.return_value = np.array([2, 1, 1, 2, 2])
        test_clusters[3].predict.return_value = np.array([1, 1, 1, 1, 1])
        test_clusters[4].predict.return_value = np.array([2, 2, 2, 1, 0])

        load_clusters_mock.return_value = test_clusters

        expected_x_data = [
            [

                1.8231455326080321, 1.8186726808547973, 45.53627052307128, 1.8214508209228513, 1.8214417815208435, 1.8214508209228515, 1.8214417815208435, 82.94210665092187, 13.020868651100015, 3.317684266036875, 1.1729963449911204e-06, 0.0010830495579571234, 0.0008600555801391519, 0.0006173372268676314, 9, 9, 0.0, 1.1729963449911204e-06, -4.798868024981334e-10, 4.241837341899848e-12, 0.0012050986289977583, 0.0005946081802024106, -0.37774073248260204, 0.0829089122517992, 0.05612991594261147, 0.0010161643226941168, 0.0009241473558045313, 0.000860055580139143, 0.0006582558348109362, 8,
                -0.28015519082546236, -0.290841269493103, -7.152085608243943, -0.2860834243297577, -0.28541713058948515, 0.2860834243297577, 0.28541713058948515, 2.0462693489190147, -27.176301122165018, 0.08185077395676059, 7.048280520397238e-06, 0.0026548597929829058, 0.0021927347660064722, 0.0021347135305405107, 6, 4, 0.0, 7.048280520397238e-06, 2.498918740908194e-09, 1.2643493628796293e-10, 0.003398019075393721, -0.00928001962785075, 0.13354491721264125, -0.4549241332259828, 0.8711322421894913, 0.0013229637096325644, 0.0010420670683976133, 0.0021927347660064722, 0.0014967280201639106, 2,
                0.20482647716999053, 0.19922617226839065, 5.03618904352188, 0.2014475617408752, 0.2016748696565628, 0.20144756174087522, 0.2016748696565628, 1.0145593067162566, -34.79223343474723, 0.04058237226865027, 1.2521373065200122e-06, 0.0011189894130509066, 0.0008708684015274082, 0.0007342621684074402, 7, 7, 0.0, 1.2521373065200122e-06, 9.421976237082505e-10, 6.956436301762484e-12, 0.001431736350059526, 0.005554742898751379, 0.6724563078207381, 1.4369333230077599, 0.15287146776214056, 0.0009215214600165668, 0.0011250871555278405, 0.0008708684015274115, 0.0007026560565035381, 6,

                0.03346084795193747, -0.023684028163552286, 0.029596449559903704, 0.0011838579823961481, -0.00020467708818614483, 0.011572190302307717, 0.010783427231945097, 0.0054236918127231045, -106.1451065993863, 0.0002169476725089242, 0.00021554615278644119, 0.01468149014189095, 0.011648734165728092, 0.010578750143758952, 11, 13, 0.0, 0.00021554615278644119, 1.9642219329292554e-06, 1.3261793006909884e-07, 0.019126512634102255, 12.40139472825564, 0.6206977093432572, -0.1455549056578258, -0.38984518945275193, 0.018602573017657657, 0.016257534083706397, 0.011648734165728092, 0.008936058701834951, 17,
                0.03292677765712142, -0.022148005291819574, 0.022238554712384936, 0.0008895421884953975, -0.00034827496856451037, 0.006635513421148062, 0.003674882557243109, 0.0025197887705996173, -121.07614794822518, 0.0001007915508239847, 0.00010000026551887146, 0.01000001327593476, 0.006725794831514358, 0.0035773172974586484, 14, 14, 0.0, 0.00010000026551887146, 8.941282343109015e-07, 5.883009965913292e-08, 0.006679260823875665, 11.241752673753597, 0.894124673203925, 2.882978725034379, -0.5272072469836313, 0.012237881927285343, 0.012715745399677387, 0.006725794831514358, 0.007400266846759394, 21,
                0.018410714436322452, -0.020530906040221453, -0.011083740345202384, -0.00044334961380809533, -0.00078250098740682, 0.00529850104264915, 0.0038048958173021673, 0.001332147180140046, -122.58369866933465, 5.328588720560184e-05, 5.308932832553806e-05, 0.007286242400959363, 0.0052807670580968255, 0.0035506598069332536, 17, 17, 0.0, 5.308932832553806e-05, -2.8430589966465105e-08, 1.3068028921135629e-08, 0.0066247194423340264, -16.43452971205976, -0.07349791611438389, 1.636557236990705, -0.4173603786623366, 0.008599969585581372, 0.008873923687059495, 0.0052807670580968255, 0.0050202417873701525, 4,

                -0.0036018222570419313, -0.006878544390201568, -0.13426509052515032, -0.005370603621006013, -0.00545855313539505, 0.005370603621006013, 0.00545855313539505, 0.0007334213992300165, -113.69886403167907, 2.933685596920066e-05, 4.934727152377719e-07, 0.0007024761314363442, 0.0005280997610092162, 0.00044607967138290353, 14, 17, 0.0, 4.934727152377719e-07, 1.604537703802468e-10, 8.820959024372778e-13, 0.0007276028394699093, -0.1308002193065884, 0.4628659238951643, 0.6223425284252819, -0.5142881252199766, 0.0009425261989235877, 0.0007862413415122164, 0.0005280997610092162, 0.00046323142991358063, 3,
                0.009915336966514587, -0.0003056257963180542, 0.09896243512630462, 0.0039584974050521846, 0.003412303328514099, 0.003989832997322082, 0.003412303328514099, 0.0005453062588456438, -127.09922683680196, 2.181225035382575e-05, 6.142548648020864e-06, 0.0024784165606331924, 0.0019422607707977294, 0.0014006882905960088, 16, 16, 0.0, 6.142548648020864e-06, 7.653051047484626e-09, 1.1231705381855474e-10, 0.0025523573160171507, 0.626100337332549, 0.5027032617372239, -0.023207974657333263, -0.4281388798472499, 0.0033814636369546257, 0.0024556075983266667, 0.0019422607707977294, 0.001539536211409486, 5,
                0.003702890872955322, -0.00017798542976379394, 0.03901468515396118, 0.0015605874061584472, 0.0014915525913238525, 0.0015841960906982423, 0.0014915525913238525, 8.236126595875248e-05, -145.39555757523746, 3.2944506383500993e-06, 8.590175860897491e-07, 0.0009268320161117381, 0.0007476761627197267, 0.000497967004776001, 13, 13, 0.0, 8.590175860897491e-07, 7.674511469158585e-11, 2.005774192931313e-12, 0.0010509610176086426, 0.5938994589179943, 0.09639347946315382, -0.2818217733784074, -0.005646914734124159, 0.001117673267920812, 0.0007128977038509536, 0.0007476761627197267, 0.0005477206786222826, 1,
                0.011099897403299754, 0.005508623762693189, 0.181029696191282, 0.00724118784765128, 0.006902676309350385, 0.007241187847651281, 0.006902676309350385, 0.0013610889240344125, -107.38706967589988, 5.44435569613765e-05, 2.0087555164039103e-06, 0.0014173057243953792, 0.0011339809541009024, 0.0009391700136045017, 16, 16, 0.0, 2.0087555164039103e-06, 3.142417285805139e-09, 1.4190276309814502e-11, 0.0016288156134833445, 0.1957283465384882, 1.1037563914772262, 0.5167110591399013, -0.3854286919421451, 0.0018229108070161447, 0.001472438358481809, 0.0011339809541009022, 0.0008502015714760339, 8,

                -0.18784510021039527, 2.107534245252609, -0.32739771827120395, 1.6200032591819762, 0.4505746516642143, -0.48753098607063294, 0.32937262245199667, -0.009329101026058197, 0.09958629223623643, -0.0069311910271644605, -0.1935330405626272, 0.002397909998893737, 0.060726716770058135, 0.0002943157939007509, -0.4419180322627212, 0.0016272075962042436, -0.32414784334540153, 0.0013328918023034928,

                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56600,

                0.0, 0.0, 0.0, 0, 0, 2, 1, 2,

                0, 1, 0, 0
            ],
            [
                1.8203834772109986, 1.817344880104065, 45.467236113548275, 1.818689444541931, 1.8183599352836608, 1.8186894445419313, 1.8183599352836608, 82.69079886515647, 12.987925147867177, 3.3076319546062587, 6.589180212504328e-07, 0.0008117376554345824, 0.0007296806335449446, 0.0008171081542966974, 5, 1, 0.0, 6.589180212504328e-07, 1.3753898564132127e-10, 8.576356055398741e-13, 0.0012707591056824175, 0.0004463310973023395, 0.25714538754931077, -1.024668307184627, 0.8700320916295162, 0.00036678810914358057, 0.0003225233762651819, 0.0007296806335449002, 0.0003556461644386818, 4,
                -0.28495741486549375, -0.291643550992012, -7.186864632368087, -0.2874745852947235, -0.28707133531570433, 0.28747458529472353, 0.28707133531570433, 2.0661526554301584, -27.070612512003297, 0.08264610621720633, 4.46902683305074e-06, 0.002114007292572743, 0.001803614282608037, 0.0014545023441314697, 3, 3, 0.0, 4.46902683305074e-06, -6.066172020116092e-09, 4.023124274813415e-11, 0.0032698869705199973, -0.007353718904943996, -0.6420890714436422, -0.985637983442238, 0.8979772909639896, 0.0007889673113822942, 0.0006512127030263216, 0.001803614282608026, 0.0011027249668993065, 11,
                0.20214893221855162, 0.2002106338739395, 5.0287485525012015, 0.20114994210004805, 0.20120994001626968, 0.2011499421000481, 0.20120994001626968, 1.0115383545902559, -34.824067464875675, 0.04046153418361023, 2.349767575516489e-07, 0.00048474401239380864, 0.00039852416038512975, 0.00028676241636277355, 3, 5, 0.0, 2.349767575516489e-07, -6.512501548756926e-12, 1.357113565249515e-13, 0.0006288602948189004, 0.002409864041386134, -0.05717556692866028, -0.5420877263970829, 0.8119381143397372, 0.00028332397341728394, 0.00019401458490665922, 0.00039852416038513197, 0.00027596240892732927, 3,

                0.01621608156710863, -0.019717880245298147, 0.027324342264910227, 0.0010929736905964092, 0.001133472443325445, 0.006048765169805847, 0.00396328535862267, 0.001600959886199939, -120.17363219694734, 6.403839544799756e-05, 6.284380395966163e-05, 0.007927408401215471, 0.005979716008352116, 0.003926822345238179, 11, 11, 0.0, 6.284380395966163e-05, -1.6128431654576735e-07, 1.3670480129033801e-08, 0.007725972993648611, 7.253064249780502, -0.32374154906426716, 0.4614561762408598, -0.378452919205364, 0.009610402989589298, 0.009255842267737353, 0.005979716008352116, 0.005204498094832879, 3,
                0.008490304462611675, -0.004760466888546944, 0.021972664073109625, 0.000878906562924385, -1.2237578630447388e-05, 0.002879299640655518, 0.0025564351119101046, 0.00033933632806613587, -139.61949028290744, 1.3573453122645435e-05, 1.280097637629388e-05, 0.0035778452141329254, 0.002931770444214344, 0.002544197533279657, 16, 18, 0.0, 1.280097637629388e-05, 2.1365373817687153e-08, 3.889677595495887e-10, 0.003684802819043398, 4.07079132761094, 0.46649377378194057, -0.6262913459135064, -0.4891709311308505, 0.004952421217846374, 0.0034956818808485773, 0.002931770444214344, 0.00205077995863162, 14,
                0.0031428650254383683, -0.004832183802500367, 0.0025682088453322645, 0.00010272835381329058, 0.0007360070012509823, 0.0016919757639989258, 0.0012560689123347402, 0.00010900922984192499, -145.02352087697653, 4.360369193677e-06, 4.349816078999813e-06, 0.0020856212693103732, 0.0016549935566261408, 0.0009204148314893245, 13, 11, 0.0, 4.349816078999813e-06, -8.014807031477207e-09, 5.4670161564258075e-11, 0.0016167253605090083, 20.302294273117653, -0.8834596707318261, -0.11059401021309245, -0.19952397690626136, 0.002641534019494429, 0.0018379473142587479, 0.0016549935566261408, 0.0012691778466888586, 4,

                -0.003642144799232483, -0.005673718452453613, -0.1160588636994362, -0.004642354547977448, -0.004628394544124603, 0.004642354547977447, 0.004628394544124603, 0.0005464937641320832, -116.81869637598871, 2.1859750565283328e-05, 3.0829481615644017e-07, 0.0005552430244104289, 0.00046441223621368396, 0.00046785622835159284, 14, 16, 0.0, 3.0829481615644017e-07, -2.795353884283808e-11, 2.0139568167595294e-13, 0.000896757841110229, -0.1196037525079453, -0.16330048054712215, -0.8810646342646318, -0.021585259409428664, 0.0006789129227399825, 0.00042963958219238376, 0.00046441223621368407, 0.00030432891911786095, 4,
                0.009011393785476685, -0.0024874597787857057, 0.09330787658691406, 0.0037323150634765625, 0.0038578838109970095, 0.004133160591125489, 0.0038578838109970095, 0.0005167341342620979, -121.73953848842147, 2.0669365370483917e-05, 6.73918963742986e-06, 0.0025959949224584125, 0.0018358443260192872, 0.0012506991624832153, 11, 11, 0.0, 6.73918963742986e-06, -9.4102997185325e-09, 1.6155978301387838e-10, 0.0024613946676254276, 0.6955454934290315, -0.5378881045098599, 0.5572788190402647, -0.324562706052825, 0.003101680800318718, 0.002786481314944216, 0.0018358443260192872, 0.0018354468796597326, 7,
                0.004539954662322998, 0.00012933611869812012, 0.0447968363761902, 0.001791873455047608, 0.001834028959274292, 0.001791873455047607, 0.001834028959274292, 0.00010822844074468205, -142.2752718917681, 4.329137629787282e-06, 1.118327150883033e-06, 0.0010575098821680264, 0.0008645175743103028, 0.0007970631122589111, 10, 10, 0.0, 1.118327150883033e-06, 7.633058340683328e-10, 3.721345152751404e-12, 0.0013568758964538573, 0.5901699582574204, 0.6454242495355346, -0.024484515204254986, 0.16256180544780063, 0.001013514151175817, 0.0009210758402729502, 0.0008645175743103027, 0.0006090455767770284, 3,
                0.0099447985399664, 0.005150750802767645, 0.16839250804460498, 0.006735700321784199, 0.006499762961522978, 0.006735700321784198, 0.006499762961522978, 0.0011714563391388632, -108.90039654363333, 4.685825356555453e-05, 1.4885947406707643e-06, 0.001220079809139863, 0.0009009503916841441, 0.0006488844689206, 11, 13, 0.0, 1.4885947406707643e-06, 2.3088322446146225e-09, 8.80325733175256e-12, 0.0011773136943385, 0.18113629627998054, 1.2712403191148074, 0.9727426841350022, -0.14885602324779915, 0.0013489383359636094, 0.001268721591316961, 0.0009009503916841444, 0.0008227290759387025, 7,

                0.23477527937845322, 2.1061640298366546, 0.2886475252162456, 1.617539502441883, 0.8201706781459265, -0.48862452739477163, 0.6243007310904234, -0.00837466961145401, 0.32392784483590054, -0.006434228003025054, 0.27742727110628035, 0.0019404416084289554, -0.033196874987561985, 0.00021406712767202418, -0.3569186884613236, 0.0009902453367831186, -0.36461443136766175, 0.0007761782091110944,

                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56604,

                0.0, 0.0, 0.0, 0, 0, 2, 1, 2,

                0, 1, 0, 0
            ],
            [
                1.8171950221061706, 1.81565922498703, 45.415944600105284, 1.8166377840042114, 1.816690170764923, 1.8166377840042116, 1.816690170764923, 82.50432567366224, 12.963416518160239, 3.3001730269464895, 1.8867475792058458e-07, 0.00043436707739029275, 0.0003759663391113044, 0.00036416053771959334, 7, 7, 0.0, 1.8867475792058458e-07, -3.631508582449855e-11, 7.445674725639677e-14, 0.0007904648780823198, 0.00023910494497855593, -0.4431149194165585, -0.9084104821173469, 0.604409981204495, 0.00032953371604285686, 0.00024083945211264324, 0.000375966339111331, 0.00021754096114481113, 11,
                -0.2880585819482803, -0.3019863277673721, -7.354539173841475, -0.294181566953659, -0.29487221837043764, 0.29418156695365905, 0.29487221837043764, 2.163986884813747, -26.57131719122977, 0.08655947539254988, 1.668105723969807e-05, 0.00408424500240841, 0.003325566349029541, 0.0024896025657653587, 3, 1, 0.0, 1.668105723969807e-05, -1.1038803627233157e-08, 5.920166647487736e-10, 0.006558617949485757, -0.013883415758172847, -0.16202672308859506, -0.8724156520116404, 0.9511335299042175, 0.0010291191438833909, 0.0007634197103501803, 0.0033255663490295473, 0.0023710052083241737, 2,
                0.2030332624912262, 0.2002712219953537, 5.0398898646235475, 0.2015955945849419, 0.201358799636364, 0.20159559458494186, 0.201358799636364, 1.0160345434750069, -34.77610775995831, 0.040641381739000275, 5.979829440436261e-07, 0.0007732935691208263, 0.0006380766153335538, 0.00047987550497052833, 7, 5, 0.0, 5.979829440436261e-07, 1.4564043638832944e-10, 8.034327485672286e-13, 0.0009881749749183766, 0.003835865415179004, 0.3149551949038986, -0.7531610915724376, 0.7825627027481976, 0.0004446402192115779, 0.0003346009655224093, 0.0006380766153335571, 0.0004368537249561895, 2,

                0.012768699222942815, -0.01732542933896184, -0.0043720768269849926, -0.0001748830730793997, -0.00010899857152253389, 0.005731375659699551, 0.005213115317746997, 0.0012630836307890234, -121.94809198250763, 5.052334523156093e-05, 5.0492761142311224e-05, 0.007105825859272884, 0.005729651096900925, 0.005104116746224463, 14, 14, 0.0, 5.0492761142311224e-05, -6.346906437570192e-08, 7.0706577929712455e-09, 0.009883452008944006, -40.63186753383917, -0.1768961642102424, -0.22666981761013805, -0.06701477358714569, 0.008847367060904313, 0.005247220570033545, 0.005729651096900925, 0.004202839450906167, 10,
                0.006784123461693525, -0.009163258224725723, 0.020526806078851226, 0.000821072243154049, 0.00129984924569726, 0.003353645801544189, 0.0026597918011248113, 0.0004416851707854945, -133.8900580828401, 1.766740683141978e-05, 1.6993247202941756e-05, 0.0041222866473526265, 0.0032411989045143127, 0.002553305961191654, 14, 14, 0.0, 1.6993247202941756e-05, -4.671786705755997e-08, 8.297139532573719e-10, 0.005802974477410316, 5.020613815317108, -0.6669118645295135, -0.1267352604121612, -0.2553430068444175, 0.005350244095704208, 0.0038402839301957164, 0.003241198904514313, 0.0025471311046581365, 3,
                0.0040593120618723335, -0.0047900791512802245, 0.0012450700276531272, 4.980280110612509e-05, -0.00017657867865636945, 0.002036342873703689, 0.001781883300282061, 0.00014354597509004652, -142.56218529488365, 5.741839003601861e-06, 5.739358684603844e-06, 0.002395695866466327, 0.0020409288607165215, 0.0019406989100389182, 15, 13, 0.0, 5.739358684603844e-06, -2.1311791614702925e-09, 7.096181007375963e-11, 0.003989415033720434, 48.10363700951928, -0.15499757745224846, -0.8457408281132315, -0.33535517083257144, 0.0030790702318578647, 0.0023096020531894424, 0.0020409288607165215, 0.0012545788417226732, 17,

                -0.0025835022330284118, -0.006283867359161377, -0.10373813509941099, -0.004149525403976439, -0.004147784411907196, 0.00414952540397644, 0.004147784411907196, 0.00044482562438793235, -119.46700725209769, 1.7793024975517294e-05, 5.744638972714497e-07, 0.0007579339663001321, 0.0005901338672637939, 0.000445441901683807, 12, 12, 0.0, 5.744638972714497e-07, -1.6791201433758746e-10, 1.2872135254037348e-12, 0.0008905664086341861, -0.18265557925583809, -0.3856449611884827, 0.9005433954308302, -0.3822876532530051, 0.0008960117275516192, 0.0008494318131008846, 0.0005901338672637938, 0.00047561109741019354, 7,
                0.008207324147224426, 0.002160823345184326, 0.10200092792510985, 0.004080037117004394, 0.004191341996192932, 0.004080037117004395, 0.004191341996192932, 0.0004548357016799365, -120.39098684304126, 1.819342806719746e-05, 1.5467251910639276e-06, 0.0012436740694667264, 0.0009301527404785155, 0.0007350891828536987, 14, 14, 0.0, 1.5467251910639276e-06, 2.39537089252303e-09, 1.3377446531410702e-11, 0.0014091432094573975, 0.30481930281552067, 1.2452399050785967, 2.5917391815085065, -0.1965089835224695, 0.0014416523277759553, 0.0008779874629608159, 0.0009301527404785157, 0.0008255550075217488, 13,
                0.005128306150436401, -0.00015306472778320312, 0.052766692638397214, 0.0021106677055358885, 0.0020530760288238526, 0.002122912883758545, 0.0020530760288238526, 0.00013381465703140804, -136.36582248439814, 5.352586281256321e-06, 8.976681180641891e-07, 0.0009474534912406988, 0.000619707546234131, 0.00037851929664611816, 16, 16, 0.0, 8.976681180641891e-07, 8.449318691035146e-10, 5.021519094706431e-12, 0.00071524977684021, 0.44888804085821027, 0.9934545194168617, 3.2316566501529156, -0.27390518406224396, 0.0011035496989885965, 0.0010627078025750043, 0.0006197075462341309, 0.000716680315904282, 15,
                0.008979416483362295, 0.0045065389928858595, 0.15826312452415148, 0.006330524980966059, 0.006274051060658584, 0.006330524980966059, 0.006274051060658584, 0.001033475983099277, -110.27082930109057, 4.133903932397108e-05, 1.2634927893357446e-06, 0.0011240519513508905, 0.0008846449785541674, 0.0005325860261006553, 12, 12, 0.0, 1.2634927893357446e-06, 4.606943010776707e-10, 4.291832640202857e-12, 0.0009590257924299329, 0.17756062170682035, 0.32437971528173964, -0.3115792250406315, -0.3881685359569506, 0.001365988688849456, 0.001110852813423099, 0.0008846449785541674, 0.0006934666908039932, 3,

                -0.0023788283232629047, 2.1108193509578705, -0.5541077236125567, 1.6150421894192697, -0.3463852157093954, -0.4957771615386009, 0.0802848099438015, -0.008229562520980834, 0.17891330512463116, -0.006260193109512329, 0.19682223116114939, 0.001969369411468506, 0.7926486456657376, -0.0009959553162334485, -0.062226594680563165, -0.0002246858741855249, 0.03868440978941439, 0.0007712694420479235,

                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                65.0, 65.0, 1625.0, 65.0, 65.0, 65.0, 65.0, 105625.0, 90.64566783214272, 4225.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,
                10.0, 10.0, 250.0, 10.0, 10.0, 10.0, 10.0, 2500.0, 50.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0, 0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13,

                0.0, 0.0, 0.0, -1.57079633,

                6, 1, 15, 943, 56609,

                0.0, 0.0, 0.0, 0, 0, 2, 1, 2,

                0, 1, 0, 0
            ]
        ]
        expected_y_data = [
            'Coding',
            'Coding',
            'Coding'
        ]

        # act
        actual_x_data, actual_y_data = extract_features(test_data_basename, test_al)

        # assert
        self.assertEqual(len(actual_x_data), len(expected_x_data))

        for point_index, actual_x_point in enumerate(actual_x_data):
            expected_x_point = expected_x_data[point_index]

            self.assertEqual(len(actual_x_point), len(expected_x_point))

            for f_index, actual_value in enumerate(actual_x_point):
                expected_value = expected_x_point[f_index]

                self.assertAlmostEqual(actual_value, expected_value, places=8)

        self.assertEqual(actual_y_data, expected_y_data)
